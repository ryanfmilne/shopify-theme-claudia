{%- comment -%}
  Alpine Announcement Bar
  Modern rotating announcement section using Alpine.js and Tailwind CSS
  Supports up to 3 messages with auto-rotation
{%- endcomment -%}

{%- liquid
  assign total_blocks = section.blocks.size
  assign rotation_speed = section.settings.rotation_speed | times: 1000
  assign show_close_button = section.settings.show_close_button
-%}

{%- if total_blocks > 0 -%}
  <div
    x-data="alpineAnnouncement({{ total_blocks }}, {{ rotation_speed }}, '{{ section.id }}', {{ show_close_button }})"
    x-show="!isClosed"
    x-cloak
    class="relative z-50 color-{{ section.settings.color_scheme }} gradient overflow-hidden"
    style="font-family: Untitled Sans, Helvetica, sans-serif;"
    @mouseenter="pauseRotation()"
    @mouseleave="resumeRotation()"
    role="region"
    aria-label="Announcements"
  >
    <div class="page-width">
      <div class="grid grid-cols-3 items-center h-[30px] gap-4">

        {%- comment -%}LEFT COLUMN: Empty for now{%- endcomment -%}
        <div class="flex items-center justify-start">
        </div>

        {%- comment -%}CENTER COLUMN: Announcement Messages{%- endcomment -%}
        <div class="flex items-center justify-center relative">
          {%- for block in section.blocks -%}
            <div
              x-show="currentIndex === {{ forloop.index0 }}"
              x-transition:enter="transition ease-in-out duration-700"
              x-transition:enter-start="opacity-0 transform translate-x-4"
              x-transition:enter-end="opacity-100 transform translate-x-0"
              x-transition:leave="transition ease-in-out duration-700"
              x-transition:leave-start="opacity-100 transform translate-x-0"
              x-transition:leave-end="opacity-0 transform -translate-x-4"
              {{ block.shopify_attributes }}
              class="announcement-message flex items-center justify-center absolute inset-0"
            >
              {%- if block.settings.link != blank -%}
                <a
                  href="{{ block.settings.link }}"
                  class="hover:opacity-80 transition-opacity font-normal text-[12px] text-white leading-[30px]"
                  {% if block.settings.open_new_tab %}target="_blank" rel="noopener noreferrer"{% endif %}
                >
                  {{ block.settings.text }}
                </a>
              {%- else -%}
                <span class="font-normal text-[12px] text-white leading-[30px]">{{ block.settings.text }}</span>
              {%- endif -%}
            </div>
          {%- endfor -%}
        </div>

        {%- comment -%}RIGHT COLUMN: Live Shopping + Close Button{%- endcomment -%}
        <div class="flex items-center justify-end gap-6">
          {%- comment -%}Live Shopping Link with Video Icon{%- endcomment -%}
          <a
            href="/pages/live-shopping"
            class="flex items-center gap-2.5 text-white hover:opacity-70 transition-opacity text-[12px] font-normal"
          >
            <span>Live Shopping</span>
            <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
            </svg>
          </a>

          {%- comment -%}Close Button{%- endcomment -%}
          {%- if show_close_button -%}
            <button
              @click="closeAnnouncement()"
              class="p-1 text-white hover:opacity-70 transition-opacity focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-white rounded"
              aria-label="Close announcement"
              type="button"
            >
              <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          {%- endif -%}
        </div>

      </div>
    </div>
  </div>
{%- endif -%}

{% schema %}
{
  "name": "Alpine Announcement",
  "tag": "section",
  "class": "alpine-announcement-section",
  "max_blocks": 3,
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-4"
    },
    {
      "type": "range",
      "id": "rotation_speed",
      "min": 3,
      "max": 10,
      "step": 1,
      "unit": "s",
      "label": "Rotation speed",
      "default": 5,
      "info": "Time between message changes (only applies when multiple messages)"
    },
    {
      "type": "checkbox",
      "id": "show_close_button",
      "label": "Show close button",
      "default": true,
      "info": "Allow users to dismiss the announcement bar (remembered via cookie)"
    }
  ],
  "blocks": [
    {
      "type": "message",
      "name": "Message",
      "limit": 3,
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Message text",
          "default": "Welcome to our store!",
          "info": "The announcement message to display"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link (optional)",
          "info": "Where to navigate when message is clicked"
        },
        {
          "type": "checkbox",
          "id": "open_new_tab",
          "label": "Open link in new tab",
          "default": false
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Alpine Announcement",
      "category": "Custom",
      "blocks": [
        {
          "type": "message",
          "settings": {
            "text": "Free shipping on orders over $50!"
          }
        },
        {
          "type": "message",
          "settings": {
            "text": "New arrivals now in stock - Shop the collection"
          }
        },
        {
          "type": "message",
          "settings": {
            "text": "Sign up for our newsletter and get 10% off your first order"
          }
        }
      ]
    }
  ]
}
{% endschema %}
